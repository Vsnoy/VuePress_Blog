# 作用域链

几乎所有编程语言最基本的功能之一，就是能够储存变量当中的值并且能在之后对这个值进行访问或修改。而作用域就是这么一套规则，用于确定在何处以及如何查找变量。
`JS` 中，作用域分为全局作用域、函数作用域以及块级作用域。

## 作用域定义

作用域是指在程序中定义变量的区域，该位置决定了变量的生命周期。通俗地理解，作用域就是变量与函数的可访问范围，即作用域控制着变量和函数的可见性和生命周期。

## 作用域分类

### 全局作用域

所有在函数外部声明的变量都处于全局作用域中。全局作用域中声明的变量和函数会作为全局对象 `window` 的属性和方法保存，可被任意访问，其生命周期伴随着页面的生命周期。

```
a = 10 // 可省略 var
var b = 20

function an(){
  c = 3 // 函数作用域中未声明而直接赋值的变量，属于全局变量
  console.log('an')
}

var bn = function(){
  console.log('bn')
}

console.log(window)
```

如上，`a`、`b`、`c` 以及 `an`、`bn` 都在全局作用域中，而全局作用域中声明的变量和函数会作为 `window` 对象的属性和方法保存。

:::tip

- 在函数作用域中，不使用变量关键字声明的变量，在赋值时会往上一级作用域寻找已经声明的同名变量，若直到全局作用域时还没找到，则会成为全局对象 `window` 的属性。
- 在没有块级作用域的情况下，`for`、`if` 等代码块中声明的变量也属于全局变量。
  
  ```
  for(var i = 0; i < 10; i++) { ... }
  console.log(i) // 10

  if(true) { var a = 1 }
  console.log(a) // 1
  ```

:::

### 函数作用域

函数声明内的词法作用域。函数内部定义的变量或函数只能在函数内部被访问。函数执行结束之后，函数内部定义的局部变量会被销毁（**闭包**除外）。

```
var a = 1

function foo(){ 
  var b = 2 
  console.log(a) // 1
  console.log(b) // 2
} 

foo();

console.log(a) // 1
console.log(b) // Uncaught ReferenceError: b is not defined
```

如上，`a` 是全局变量，可被任意访问，而 `b` 是只属于函数 `foo` 的内部变量，所以在外部访问会报错。

### 块级作用域

包含 `let` 和 `const` 关键字声明的一对 `{}` 内的词法作用域。

```
{
    console.log(a) // Uncaught ReferenceError: a is not defined
    let a = 1
    console.log(a) // 1
}

console.log(a) // Uncaught ReferenceError: a is not defined
```

这样，通过 `let` 声明的变量就只在所在代码块内有效，不会泄漏到全局，也不会如 `var` 声明的变量被提升到块的顶部。

## 作用域链

作用域链本质上就是查找变量的链条。当访问一个变量时，解释器首先会在当前作用域中查找，若没找到则会在外层嵌套的作用域中继续查找，直到找到该变量，或抵达最外层的全局作用域为止，这就是作用域链。

可用以下几句话来概括：

- 查看当前作用域，若当前作用域声明了这个变量，就确定结果
- 查看当前作用域的上级作用域中有没有声明
- 依次往上查找，直到全局作用域为止
- 若全局作用域中也没有，我们就认为这个变量未声明

## 参考

- [一文搞懂 JavaScript 作用域](https://cloud.tencent.com/developer/article/1851118)
- [探访 JS 作用域](https://blackstarxing.github.io/2018-10-18-javascript-scope.html)
